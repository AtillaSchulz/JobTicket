package de.rc.jobticket.beans;
import java.io.Serializable;
import java.util.List;

import javax.faces.bean.ManagedBean;

import org.primefaces.event.SelectEvent;

import de.rc.DBZugriff;
import de.rc.jobticket.entities.Job;
import de.rc.jobticket.entities.Jobbearbeiter;
import de.rc.jobticket.entities.Kosten;
import de.rc.jobticket.entities.Kunden;
import de.rc.jobticket.entities.Produkteigenschaften;


/**
 * @author janine & atilla
 * 
 */
@ManagedBean
public class JobBean implements Serializable {

	private static final long serialVersionUID = -5747251292554950020L;
	private int alte_jobnummer;
	private String job; // alter begriff: Jobbeschreibung
	private String kundenname;
	private String kundenkuerzel;
	private List<Kosten> kostens;
	private List<Produkteigenschaften> produkteigenschaftens;
	private List<Jobbearbeiter> jobbearbeiters;
	private DBZugriff dbAccess;
	private boolean emptyField_job;
	private boolean emptyField_kunde;
	private boolean erledigt;
	private Kunden kunden;
	private List<Job> jobliste;
	private int jobnummer;

	public JobBean() {
		dbAccess = new DBZugriff();
		job = "";
		kundenname = "";
		
	}

	/**
	 * @return the alte_jobnummer
	 */
	public int getAlte_jobnummer() {
		return alte_jobnummer;
	}

	public List<String> completeKundennamen(String str) {
		return dbAccess.completeKundennamen(str);
	}

	public List<String> completeKundenkuerzel(String str) {
		return dbAccess.completeKundenkuerzel(str);
	}

	/**
	 * @param alte_jobnummer
	 *            the alte_jobnummer to set
	 */
	public void setAlte_jobnummer(int alte_jobnummer) {
		this.alte_jobnummer = alte_jobnummer;
	}

	/**
	 * @return the job
	 */
	public String getJob() {
		return job;
	}

	/**
	 * @param job
	 *            the job to set
	 */
	public void setJob(String job) {
		this.job = job;
	}

	/**
	 * @return the kundenname
	 */
	public String getKundenname() {
		return kundenname;
	}

	/**
	 * @param kundenname
	 *            the kundenname to set
	 */
	public void setKundenname(String kundenname) {
		this.kundenname = kundenname;
	}

	/**
	 * @return the kundenkuerzel
	 */
	public String getKundenkuerzel() {
		return kundenkuerzel;
	}

	/**
	 * @param kundenkuerzel
	 *            the kundenkuerzel to set
	 */
	public void setKundenkuerzel(String kundenkuerzel) {
		this.kundenkuerzel = kundenkuerzel;
	}

	/**
	 * @return the serialversionuid
	 */
	public static long getSerialversionuid() {
		return serialVersionUID;
	}

	/**
	 * @return the kostens
	 */
	public List<Kosten> getKostens() {
		return kostens;
	}

	/**
	 * @param kostens
	 *            the kostens to set
	 */
	public void setKostens(List<Kosten> kostens) {
		this.kostens = kostens;
	}

	/**
	 * @return the produkteigenschaftens
	 */
	public List<Produkteigenschaften> getProdukteigenschaftens() {
		return produkteigenschaftens;
	}

	/**
	 * @param produkteigenschaftens
	 *            the produkteigenschaftens to set
	 */
	public void setProdukteigenschaftens(
			List<Produkteigenschaften> produkteigenschaftens) {
		this.produkteigenschaftens = produkteigenschaftens;
	}

	/**
	 * @return the jobbearbeiters
	 */
	public List<Jobbearbeiter> getJobbearbeiters() {
		return jobbearbeiters;
	}

	/**
	 * @param jobbearbeiters
	 *            the jobbearbeiters to set
	 */
	public void setJobbearbeiters(List<Jobbearbeiter> jobbearbeiters) {
		this.jobbearbeiters = jobbearbeiters;
	}

	/**
	 * @return the emptyField_job
	 */
	public boolean isEmptyField_job() {
		return emptyField_job;
	}

	/**
	 * @param emptyField_job
	 *            the emptyField_job to set
	 */
	public void setEmptyField_job(boolean emptyField_job) {
		this.emptyField_job = emptyField_job;
	}

	/**
	 * @return the emptyField_kunde
	 */
	public boolean isEmptyField_kunde() {
		return emptyField_kunde;
	}

	/**
	 * @param emptyField_kunde
	 *            the emptyField_kunde to set
	 */
	public void setEmptyField_kunde(boolean emptyField_kunde) {
		this.emptyField_kunde = emptyField_kunde;
	}

	/**
	 * @return the erledigt
	 */
	public boolean isErledigt() {
		return erledigt;
	}

	/**
	 * @param erledigt
	 *            the erledigt to set
	 */
	public void setErledigt(boolean erledigt) {
		this.erledigt = erledigt;
	}

	/**
	 * @return the jobnummer
	 */
	public int getJobnummer() {
		return jobnummer;
	}

	/**
	 * @param jobnummer the jobnummer to set
	 */
	public void setJobnummer(int jobnummer) {
		this.jobnummer = jobnummer;
	}

	/**
	 * @return the kunden
	 */
	public Kunden getKunden() {
		kunden = dbAccess.findKundenWithName(this.kundenname);
		return kunden;
	}

	public Job erstelleJob(){
		Job job_db = null;
		if (this.job.trim().compareTo("") == 0) {
			System.err.println("Jobfeld ist leer.");
			emptyField_job = true;
			// throw (new Exception("JobFeld ist leer"));
		} else {
			emptyField_job = false;

		}
		Kunden kunde = getKunden();
		if (kunde == null) {
			emptyField_kunde = true;
			// throw (new Exception("Kunde konnte nicht bestimmt werden"));
		} else {
			emptyField_kunde = false;
		}

		if (emptyField_kunde || emptyField_job) {
			System.err.println("Kunde- oder JobFeld wurden fehlerhaft ausgefüllt");
			return null;
		}

		Job jobTicket = new Job();
		jobTicket.setAlteJobnummer(alte_jobnummer);
		System.out.println("erledigt");
		if (erledigt) {
			jobTicket.setErledigt(1);
		} else {
			jobTicket.setErledigt(0);
		}
		if (this.jobbearbeiters != null) {
			jobTicket.setJobbearbeiters(jobbearbeiters);
		}
		if (this.job.trim().compareTo("") != 0) {
			jobTicket.setJobbeschreibung(this.job);
		}
		if (this.kostens != null) {
			jobTicket.setKostens(kostens);
		}
		System.err.println("kunde");
		jobTicket.setKunden(getKunden());
		System.out.println("produkt");
		if (this.produkteigenschaftens != null) {
			jobTicket.setProdukteigenschaftens(produkteigenschaftens);
		}

		try {
			dbAccess.addJob(jobTicket, dbAccess.createEntitymanager());

			List<Job> list = dbAccess.getDatalist(Job.class,
					dbAccess.createEntitymanager());
			jobTicket = list.get(list.size() - 1);
			jobTicket.generateName();// wird benötigt damit der richtige name
										// generiert wird
			job_db = dbAccess.updateJob(jobTicket,
					dbAccess.createEntitymanager());
		} catch (Exception e) {
			e.printStackTrace();
			return job_db;
		}
		return job_db;
	}

	/**
	 * @return the jobliste
	 */
	public List<Job> getJobliste() {

		jobliste = dbAccess.getDatalist(Job.class,
				dbAccess.createEntitymanager());
		System.out.println("Neuladen der jobliste!!!!!!!!!!!!!!");
		System.out.println(jobliste.get(0).getJobbeschreibung());
		return jobliste;
	}

	/**
	 * @param jobliste
	 *            the jobliste to set
	 */
	public void setJobliste(List<Job> jobliste) {
		this.jobliste = jobliste;
	}

	public void findKundenKuerzel(SelectEvent event) {
		Kunden kunde = dbAccess.findKundenWithName(this.getKundenname());
		this.kundenkuerzel = kunde.getKundenkuerzel();
	}

	public void findKundenname(SelectEvent event) {
		Kunden kunde = dbAccess.findKundenWithKuerzel(this.getKundenkuerzel());
		this.kundenname = kunde.getKunde();
	}

}
